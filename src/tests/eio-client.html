<head>
  <title> test </title>
  <script src="../../../engine.io-client/dist/engine.io.js"></script>
  <script>
    async function main() {
		const mode = 2;
		var socket;
		if (mode == 2) {	// With Web PubSub
			let res = await fetch(`http://localhost:3000/negotiate?id=user1`)
			let data = await res.json();
			let url = data.url;
			// sample url = "ws://localhost:8080/client/hubs/sample_chat/?access_token=...";
			console.log(url);
			path = "/clients/engineio/hubs/eio_hub";
			socket = new eio(url, {
					transports: ['websocket'],
					transportOptions: {
					websocket: { extraHeaders: {'Access-Control-Allow-Origin': '*', 'WebHook-Allowed-Origin': "*"} },
					// subprotocols: ["json.webpubsub.azure.v1"],
					reconnection:false
				},
				path: path
			});  
			setInterval(() => {console.log(socket.readyState);}, 3000);
		}
		else {		// Without Web PubSub
			socket = new eio("localhost:3000", {
				transports: ['websocket'],
					transportOptions: {
					websocket:{
						extraHeaders: {
						'Access-Control-Allow-Origin': '*',
						}
					},
				},
			});
			socket.on("event-on-client", () => { console.log("[client] my event is called.")})
		}
    
		console.log(socket.readyState)
		socket.on('open', () => {
			console.log("Client conn open");
			socket.on('message', data => {console.log("onMessage " + data + "\n");});
			socket.on('close', () => {});
			socket.send("[from client][socket.send] hello");
		});
  	}
	main();
  </script>
</head>